import * as fs from 'fs';
import * as path from 'path';
import AlipaySdk from '../lib/alipay';
import AliPayForm from '../lib/form';

const keyPath = path.join(__dirname, './fixtures/app-private-key.pem');
const keyContent = fs.readFileSync(keyPath, 'ascii');
const alipaySdk = new AlipaySdk({
  appId: '2016123456789012', // 需要替换
  privateKey: keyContent, // 需要替换
});

// that's it !
console.log(alipaySdk);



Promise.resolve((async () => {
  const result = await alipaySdk.exec('alipay.trade.close', {
    notifyUrl: 'http://notify_url',
    appAuthToken: '',
    // 通过 bizContent 传递请求参数
    bizContent: {
      tradeNo: '',
      outTradeNo: '',
      operatorId: '',
    },
  });
  
  console.log(result.code);
  console.log('tradeNo: %s, outTradeNo: %s', result.tradeNo, result.outTradeNo);
  if (typeof result === 'object') {
    // 从官方文档看到，result 包含 tradeNo、outTradeNo 2 个 key
  }

  const result2 = await alipaySdk.exec('alipay.trade.close', { }, { formData: new AliPayForm(), });
  console.log(result2.code);
})());